# Adversarial-Swarm (HIVE-ZERO)

A Hierarchical Multi-Agent Reinforcement Learning (H-MARL) system implementing adversarial swarm intelligence for network security research.

## Architecture

HIVE-ZERO uses a **Sparse Mixture-of-Experts (MoE)** architecture with a learned gating network that dynamically activates the most relevant experts for each observation. The system features **red/blue adversarial co-evolution**: both teams train simultaneously in an arms race, with a persistent Threat Intelligence Database that ensures the swarm continuously adapts — like a threat analyst who never sleeps.

### Expert Clusters (19 Experts)

| Cluster | Experts | Purpose |
|---------|---------|---------|
| **A — Recon** | Cartographer (3-layer GAT), DeepScope (Multi-Head Attn Mask), Chronos (Transformer Temporal) | Network mapping, constraint enforcement, timing |
| **B — Attack** | Sentinel (BERT), PayloadGen (T5), Mutator (Adam Optimiser) | Payload classification, generation, and adversarial optimisation |
| **C — Post-Exploit** | Mimic (Spectral-Norm GAN), Ghost (Entropy-Gated), Stego (VAE), Cleaner (Residual) | Traffic shaping, hiding, steganography, cleanup |
| **D — Active Defense** | Tarpit (25 traps, Multi-Head Attn Fusion) | Spectral/temporal/chaotic trap arsenal with attention-weighted fusion |
| **E — Kill Chain** | FeedbackLoop (Multi-Scale), Flashbang (Adaptive Burst), GlassHouse (Phase-Modulated) | Counter-strike synergisers auto-activated with Tarpit |
| **F — Blue Team** | WAF (Signature Bank), EDR (Transformer Behavioural), SIEM (Alert Prototype Correlator), IDS (Multi-Scale Conv) | Adversarial detection stack that co-evolves with the red team |
| **G — Red Booster** | PreAttackBooster (Gated Evasion Encoder) | Hardens payloads against the full blue-team stack before delivery |

### Synergy Logic

When the **Tarpit** expert is activated by the gating network, the **Kill Chain** cluster (FeedbackLoop, Flashbang, GlassHouse) is force-enabled to execute a coordinated quad-strike response.

### Adversarial Co-Evolution

The training loop alternates between **red-team** and **blue-team** optimisation steps:

1. **Red step** — Minimises detection probability across WAF + EDR + SIEM + IDS while maximising payload diversity, stealth, and information gain.
2. **Blue step** — Maximises detection probability on payloads generated by the red team this epoch.
3. **Threat Intel evolution** — Successful evasions and caught payloads are recorded into the `ThreatIntelDB`, which maintains separate attack/defence signature banks updated via EMA. Both teams query this database to inform their next decisions.

### Threat Intelligence Database

The `ThreatIntelDB` maintains:
- **Attack Bank** — EMA-updated signature prototypes of payloads that successfully evaded detection (red-team imitation source)
- **Defence Bank** — EMA-updated prototypes of caught payloads (blue-team recognition patterns)
- **Novelty Gate** — Prevents mode collapse by only storing sufficiently novel embeddings
- **Generational Counter** — Tracks co-evolution progress and evasion rate trends

## Project Structure

```
hive_zero_core/
├── __init__.py
├── hive_mind.py              # Master orchestrator with gating network
├── agents/
│   ├── base_expert.py        # Abstract expert base class with gating logic
│   ├── recon_experts.py      # Cartographer, DeepScope, Chronos
│   ├── attack_experts.py     # Sentinel, PayloadGen, Mutator
│   ├── defense_experts.py    # Tarpit with TrapArsenal
│   ├── post_experts.py       # Mimic, Ghost, Stego, Cleaner
│   ├── offensive_defense.py  # FeedbackLoop, Flashbang, GlassHouse
│   ├── blue_team.py          # WAF, EDR, SIEM, IDS
│   └── red_booster.py        # PreAttackBooster
├── memory/
│   ├── foundation.py         # Synthetic experience generator and weight init
│   ├── graph_store.py        # Network log → PyG graph encoder
│   └── threat_intel_db.py    # Evolving threat intelligence database
├── training/
│   ├── adversarial_loop.py   # Red/blue adversarial co-evolution training loop
│   └── rewards.py            # Composite reward (R_adv + R_info + R_stealth + R_temporal)
└── utils/
    └── logging_config.py     # Logging configuration
```

## Installation

```bash
pip install -e .
# or
pip install -r requirements.txt
```

## Usage

```python
from hive_zero_core.hive_mind import HiveMind

# Initialize with pretrained knowledge bootstrap
hive = HiveMind(observation_dim=64, pretrained=True)

# Process network logs
logs = [
    {"src_ip": "192.168.1.1", "dst_ip": "10.0.0.5", "port": 80, "proto": 6},
    {"src_ip": "10.0.0.5", "dst_ip": "8.8.8.8", "port": 53, "proto": 17},
]
results = hive.forward(logs, top_k=5)

# Drive co-evolution after each forward pass
hive.evolve_threat_intel(results)

# Inspect threat intelligence state
stats = hive.threat_intel.get_stats()
print(f"Generation {stats['generation']}, Evasion rate: {stats['avg_evasion_rate']:.1%}")
```

## Training

```python
from hive_zero_core.training.adversarial_loop import train_hive_mind_adversarial

# Red/blue adversarial co-evolution with ThreatIntelDB
train_hive_mind_adversarial(num_epochs=100)
```

## Requirements

- Python ≥ 3.10
- PyTorch ≥ 2.6
- PyTorch Geometric ≥ 2.3
- Transformers ≥ 4.48
- See `requirements.txt` for full list
